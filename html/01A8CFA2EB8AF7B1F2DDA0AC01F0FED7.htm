<html><head><meta http-equiv="X-UA-Compatible" content="IE=edge" /><link rel="shortcut icon" href="../icons/favicon.ico" /><link rel="stylesheet" type="text/css" href="../styles/branding.css" /><link rel="stylesheet" type="text/css" href="../styles/branding-en-US.css" /><script type="text/javascript" src="../scripts/branding.js"> </script><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><title>Long running code</title><meta name="Language" content="en-us" /><meta name="Microsoft.Help.Id" content="01A8CFA2EB8AF7B1F2DDA0AC01F0FED7" /><meta name="Description" content="Previous section: The code editor window in detail" /><meta name="Microsoft.Help.ContentType" content="Concepts" /><meta name="BrandingAware" content="true" /><link type="text/css" rel="stylesheet" href="../styles/highlight.css" /><script type="text/javascript" src="../scripts/highlight.js"> </script><link rel="stylesheet" type="text/css" href="../styles/branding-Website.css" /><script type="text/javascript" src="../scripts/jquery-1.11.0.min.js"></script><script type="text/javascript" src="../scripts/branding-Website.js"></script><script type="text/javascript" src="../scripts/clipboard.min.js"></script></head><body onload="OnLoad('cs')"><input type="hidden" id="userDataCache" class="userDataStyle" /><div class="pageHeader" id="PageHeader">Altaxo user manual and class reference<form id="SearchForm" method="get" action="#" onsubmit="javascript:TransferToSearchPage(); return false;"><input id="SearchTextBox" type="text" maxlength="200" /><button id="SearchButton" type="submit"></button></form></div><div class="pageBody"><div class="leftNav" id="leftNav"><div id="tocNav"><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="../html\1B7FE024E7E614BFA13DAA1FD005CB2E.htm" title="Altaxo user manual and class reference" tocid="roottoc">Altaxo user manual and class reference</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="../html/1B7FE024E7E614BFA13DAA1FD005CB2E.htm" title="Altaxo user manual" tocid="1B7FE024E7E614BFA13DAA1FD005CB2E">Altaxo user manual</a></div><div class="toclevel1" data-toclevel="1" data-childrenloaded="true"><a class="tocExpanded" onclick="javascript: Toggle(this);" href="#!" /><a data-tochassubtree="true" href="../html/CBDD41AAA1B05A4B2362BE258C1A1A9D.htm" title="Altaxo's code editor" tocid="CBDD41AAA1B05A4B2362BE258C1A1A9D">Altaxo's code editor</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/1AE54454196F6ED80D4D5722F394B7FC.htm" title="Keyboard shortcuts and commands" tocid="1AE54454196F6ED80D4D5722F394B7FC">Keyboard shortcuts and commands</a></div><div class="toclevel2" data-toclevel="2"><a data-tochassubtree="false" href="../html/A801476992A9D8BE7D8039466EFC262F.htm" title="The code editor window in detail" tocid="A801476992A9D8BE7D8039466EFC262F">The code editor window in detail</a></div><div class="toclevel2 current" data-toclevel="2"><a data-tochassubtree="false" href="../html/01A8CFA2EB8AF7B1F2DDA0AC01F0FED7.htm" title="Long running code" tocid="01A8CFA2EB8AF7B1F2DDA0AC01F0FED7">Long running code</a></div></div><div id="tocResizableEW" onmousedown="OnMouseDown(event);"></div><div id="TocResize" class="tocResize"><img id="ResizeImageIncrease" src="../icons/TocOpen.gif" onclick="OnIncreaseToc()" alt="Click or drag to resize" title="Click or drag to resize" /><img id="ResizeImageReset" src="../icons/TocClose.gif" style="display:none" onclick="OnResetToc()" alt="Click or drag to resize" title="Click or drag to resize" /></div></div><div class="topicContent" id="TopicContent"><table class="titleTable"><tr><td class="titleColumn"><h1>Long running code</h1></td></tr></table><span class="introStyle"></span> <div class="introduction"><p>
Previous section: <a href="A801476992A9D8BE7D8039466EFC262F.htm">The code editor window in detail</a></p><p>This topic contains the following sections:</p><ul class="autoOutline"><li class="outlineSectionEntry"><a href="#DEF95C9E1EF58CB82E6E71C1742C1880">Allow cancellation of code execution at defined points
</a></li><li class="outlineSectionEntry"><a href="#331A4511FC4CFA928435F4BC88304F59">Report the progress to the user
</a></li></ul><hr /><p>
Long running code in Altaxo is code that runs for more than 10 seconds. If your code runs for more than 10 seconds, another dialog box will open, which allows you to cancel or interrupt code execution.
You can help to make long running code a little bit more responsive.
</p><p>
There is a variable <span class="code">reporter</span> available in the <span class="code">Execute</span> method (<span class="code">Execute</span> is the default method of the worksheet script). The <span class="code">reporter</span> variable can and should be used for the following two purposes:
</p><ul><li><p>
To allow the user to cancel execution, and to return from code execution in a defined state.
</p></li><li><p>
To show the user the progress of your code execution.
</p></li></ul></div><div class="collapsibleAreaRegion" id="DEF95C9E1EF58CB82E6E71C1742C1880"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID1RB')" onkeypress="SectionExpandCollapse_CheckKey('ID1RB', event)" tabindex="0"><img id="ID1RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Allow cancellation of code execution at defined points
</span></div><div id="ID1RBSection" class="collapsibleSection"><p>
To allow the user to cancel long running code, look at the following example:
</p><div class="codeSnippetContainer"><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EABADAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID0EABADAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EABADAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="highlight-keyword">for</span> (<span class="highlight-keyword">int</span> i = <span class="highlight-number">0</span>; i &lt; <span class="highlight-number">100000</span>; i++)
{
    Foo(); <span class="highlight-comment">// method Foo() runs moderately long (say &lt; 1 s)</span>

    <span class="highlight-keyword">if</span> (reporter.CancellationPending)
        <span class="highlight-keyword">break</span>; <span class="highlight-comment">// or: return</span>
}</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EABADAAA");</script><p>
Here, the <span class="code">if (reporter.CancellationPending)</span> statement ask the <span class="code">reporter</span> if the user has requested to cancel the execution, and if so, ends the loop with a <span class="code">break</span> statement.
</p></div><div class="collapsibleAreaRegion" id="331A4511FC4CFA928435F4BC88304F59"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('ID2RB')" onkeypress="SectionExpandCollapse_CheckKey('ID2RB', event)" tabindex="0"><img id="ID2RBToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Report the progress to the user
</span></div><div id="ID2RBSection" class="collapsibleSection"><p>
The example above can be extended to show progress to the user.
</p><div class="codeSnippetContainer"><div class="codeSnippetContainerCodeContainer"><div class="codeSnippetToolBar"><div class="codeSnippetToolBarText"><a id="ID0EACACAAA_copyCode" href="#" class="copyCodeSnippet" onclick="javascript:CopyToClipboard('ID0EACACAAA');return false;" title="Copy">Copy</a></div></div><div id="ID0EACACAAA_code_Div1" class="codeSnippetContainerCode" style="display: block"><pre xml:space="preserve"><span class="highlight-keyword">int</span> len = <span class="highlight-number">100000</span>;
<span class="highlight-keyword">for</span> (<span class="highlight-keyword">int</span> i = <span class="highlight-number">0</span>; i &lt; len; i++)
{
    Foo(); <span class="highlight-comment">// method foo runs moderately long (&lt; 1 s)</span>

    <span class="highlight-keyword">if</span> (reporter.CancellationPending)
        <span class="highlight-keyword">break</span>; <span class="highlight-comment">// or: return</span>

    <span class="highlight-keyword">if</span> (reporter.ShouldReportNow)
        reporter.ReportProgress(<span class="highlight-keyword">string</span>.Format(<span class="highlight-literal">"{0} of {1}"</span>, i, len), i / (<span class="highlight-keyword">double</span>)len);
}</pre></div></div></div><script type="text/javascript">AddLanguageTabSet("ID0EACACAAA");</script><p>
Here, the statement <span class="code">if (reporter.ShouldReportNow)</span> first asks if it is necessary to report now (this property is set every second or so). If so, the method <span class="code">ReportProgress</span> is called, which reports the progress both as text (<span class="code">string.Format...</span>) as well as as a numerical value in the range from 0 to 1. This value is calculated using the loop variable <span class="code">i</span> and dividing it to the total number of loops <span class="code">len</span>.
</p><p>
Of course, you can omit the <span class="code">if (reporter.ShouldReportNow)</span> statement and directly call the <span class="code">ReportProgress</span> method. For smaller loops this is OK, but for a loop as shown here, this would call the <span class="code">string.Format</span> method and <span class="code">ReportProgress</span> method a hundred thousand times. Not very effective!
</p></div><hr /><div id="ID3RBSection" class="collapsibleSection"><p>
Next section: <a href="2F5E6BE1D416EEF88458DAC931E96092.htm">Project organization</a></p></div></div></div><div id="pageFooter" class="pageFooter">Altaxo can be downloaded from <a href="https://sourceforge.net/projects/altaxo/files/Altaxo/">SourceForge</a>. Source code available on <a href="https://github.com/Altaxo/Altaxo">Github</a>.<p><a href="https://sourceforge.net/u/dlellinger/profile/" target="_blank">(C) Dr. Dirk Lellinger 2002 - 2018</a></p><div class="feedbackLink">Send comments on this topic to
        <a id="HT_MailLink" href="mailto:dlellinger%40users.sourceforge.net?Subject=Altaxo user manual and class reference">dlellinger@users.sourceforge.net</a></div>
        <script type="text/javascript">
        var HT_mailLink = document.getElementById("HT_MailLink");
        var HT_mailLinkText = HT_mailLink.innerHTML;
        HT_mailLink.href += ": " + document.title + "\u0026body=" + encodeURIComponent("Your feedback is used to improve the documentation and the product. Your e-mail address will not be used for any other purpose and is disposed of after the issue you report is resolved. While working to resolve the issue that you report, you may be contacted via e-mail to get further details or clarification on the feedback you sent. After the issue you report has been addressed, you may receive an e-mail to let you know that your feedback has been addressed.");
        HT_mailLink.innerHTML = HT_mailLinkText;
        </script></div></body></html>