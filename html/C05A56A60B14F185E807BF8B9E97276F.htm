<html><head><meta http-equiv="X-UA-Compatible" content="IE=edge" /><meta http-equiv="Content-Type" content="text/html; charset=UTF-8" /><meta name="Microsoft.Help.SelfBranded" content="true" /><meta name="Language" content="en-us" /><meta name="Microsoft.Help.Locale" content="en-us" /><meta name="Microsoft.Help.TopicLocale" content="en-us" /><link rel="shortcut icon" href="../icons/favicon.ico" /><link rel="stylesheet" type="text/css" href="../styles/branding.css" /><link rel="stylesheet" type="text/css" href="../styles/branding-en-US.css" /><script type="text/javascript" src="../scripts/branding.js"></script><title>Spectroscopy</title><meta name="Microsoft.Help.Id" content="C05A56A60B14F185E807BF8B9E97276F" /><meta name="Microsoft.Help.ContentType" content="Concepts" /><meta name="Description" content="Previous section: Scientific applications" /><link rel="stylesheet" type="text/css" href="../styles/branding-Website.css" /><script type="text/javascript" src="../scripts/jquery-3.5.1.min.js"></script><script type="text/javascript" src="../scripts/branding-Website.js"></script><script type="text/javascript" src="../scripts/clipboard.min.js"></script></head><body onload="SetDefaultLanguage('cs');"><input type="hidden" id="userDataCache" class="userDataStyle" /><div id="PageHeader" class="pageHeader">Altaxo user manual and class reference<form id="SearchForm" method="get" action="#" onsubmit="TransferToSearchPage(); return false;"><input id="SearchTextBox" type="text" maxlength="200" /><button id="SearchButton" type="submit"></button></form></div><div class="pageBody"><div class="leftNav" id="leftNav"><div id="tocNav"><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="Toggle(this);" href="#!" /><a data-tochassubtree="true" href="../html/1B7FE024E7E614BFA13DAA1FD005CB2E.htm" title="Altaxo user manual and class reference" tocid="roottoc">Altaxo user manual and class reference</a></div><div class="toclevel0" data-toclevel="0"><a class="tocCollapsed" onclick="Toggle(this);" href="#!" /><a data-tochassubtree="true" href="../html/1B7FE024E7E614BFA13DAA1FD005CB2E.htm" title="Altaxo user manual" tocid="1B7FE024E7E614BFA13DAA1FD005CB2E">Altaxo user manual</a></div><div class="toclevel1" data-toclevel="1" data-childrenloaded="true"><a class="tocExpanded" onclick="Toggle(this);" href="#!" /><a data-tochassubtree="true" href="../html/6A78480867332D5D0A91A47BC4F120D0.htm" title="Scientific applications" tocid="6A78480867332D5D0A91A47BC4F120D0">Scientific applications</a></div><div class="toclevel2 current" data-toclevel="2"><a data-tochassubtree="false" href="../html/C05A56A60B14F185E807BF8B9E97276F.htm" title="Spectroscopy" tocid="C05A56A60B14F185E807BF8B9E97276F">Spectroscopy</a></div></div><div id="tocResizableEW" onmousedown="OnMouseDown(event);"></div><div id="TocResize" class="tocResize"><img id="ResizeImageIncrease" src="../icons/TocOpen.gif" onclick="OnIncreaseToc()" alt="Click or drag to resize" title="Click or drag to resize" /><img id="ResizeImageReset" src="../icons/TocClose.gif" style="display:none" onclick="OnResetToc()" alt="Click or drag to resize" title="Click or drag to resize" /></div></div><div id="TopicContent" class="topicContent"><table class="titleTable"><tr><td class="titleColumn"><h1>Spectroscopy</h1></td></tr></table><div><p>
Previous section: <a href="6A78480867332D5D0A91A47BC4F120D0.htm">Scientific applications</a></p><p>This topic contains the following sections:</p><ul><li><a href="#Section_ImportOfSpectra">Import of spectra</a></li><li><a href="#Section_SpectralPreprocessing">Spectral preprocessing</a></li><li><a href="#Section_PeakSearchingAndFitting">Peak searching and fitting</a></li><li><a href="#FCC125D44CCD76A52BBA4BE955537F85">Raman spectroscopy</a></li></ul><hr /></div><div class="collapsibleAreaRegion" id="Section_ImportOfSpectra"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('IDBAB')" onkeypress="SectionExpandCollapse_CheckKey('IDBAB', event)" tabindex="0"><img id="IDBABToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Import of spectra</span></div><div id="IDBABSection" class="collapsibleSection"><p>
Spectra can be imported into Altaxo in various formats:
</p><ul><li><p>
Ascii (.txt; .dat; .csv)
</p></li><li><p>
Galactic SPC (.spc)
</p></li><li><p>
Jcamp-DX (.dx; .jdx)
</p></li><li><p>
Renishaw (.wdf)
</p></li></ul><p>
Some of these formats, e.g. Galactic SPC files, can contain more than one spectrum per file. In this case, all contained spectra are imported from the file.
</p><p>
In order to import one or multiple spectra, first create an empty worksheet. Either use the menu <span class="code">File</span> → <span class="code">New</span> → <span class="code">Worksheet</span>, or use the toolbar button <span class="mediaInline"><artLink target="Icons.16x16" /></span>.
</p><p>
The next action depends on the file format to import:
</p><ul><li><p>
For Ascii files, you can use the toolbar button <span class="mediaInline"><artLink target="Icons.16x16" /></span> for import, or the menu <span class="code">File</span> → <span class="code">Import</span> → <span class="code">Ascii</span>. If multiple spectra needs to be imported into one worksheet (for instance for chemometric analysis), use <span class="code">File</span> → <span class="code">Import</span> → <span class="code">Ascii (all into a single worksheet)</span>. Select all files that should be imported. Further information can be found in the section <a href="CCE945B2EC2C578D8C49120D55FACEE3.htm#Section_Tables_ImportingAscii">"Importing ASCII data"</a>.
</p></li><li><p>
For all other files, use the menus <span class="code">File</span> → <span class="code">Import</span> → <span class="code">Galactic SPC files</span>, <span class="code">File</span> → <span class="code">Import</span> → <span class="code">JCamp-DX files</span>, or <span class="code">File</span> → <span class="code">Import</span> → <span class="code">Renishaw .wdf files</span>. Here too, you can select multiple files.
</p></li></ul><p><span class="mediaInline"><img alt="A09570BF5D0F36251993D8D16D7681AE" src="../media/A09570BF5D0F36251993D8D16D7681AE.png" /></span></p><p>
Fig. 1: Example of a worksheet after import of three .spc files. Note that the first "row" is a property, designating the original file name of the column. Furthermore, all three spectra have a common x-column named "X".
</p><p>
After successful import of the data, the worksheet contains a data source that holds all information of the import: which file(s) were imported, and which options were used for import. You can open the dialog to edit these data by clicking on the question mark <span class="mediaInline"><artLink target="Icons.16x16" /></span> in the toolbar. If you simple want to reimport the data without changing the file names or the options (e.g. when you have accidentally deleted your data), you can click on the <span class="code">Requery table data source</span> button <span class="mediaInline"><artLink target="Icons.16x16" /></span> in the toolbar.
</p><p><span class="mediaInline"><img alt="E7DF7242FE17E74F053E0BF066033F2C" src="../media/E7DF7242FE17E74F053E0BF066033F2C.png" /></span></p><p>
Fig. 2: Data source dialog of the example worksheet used above. In the options, the name of the columns (which starts now with "Y") can be changed. The data source contains the three file names of the imported spectra.
</p></div><div class="collapsibleAreaRegion" id="Section_SpectralPreprocessing"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('IDCAB')" onkeypress="SectionExpandCollapse_CheckKey('IDCAB', event)" tabindex="0"><img id="IDCABToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Spectral preprocessing</span></div><div id="IDCABSection" class="collapsibleSection"><p>
For many spectra that are output by a spectrometer, spectral preprocessing might be necessary prior to the further evaluation of the spectra, for instance by chemometric methods.
</p><p>
Spectral preprocessing includes:
</p><ul><li><p>
removal of cosmic spikes (excitation of single spectrometer pixels by cosmic radiation)
</p></li><li><p>
x-axis calibration (wavelength correction by a calibration)
</p></li><li><p>
y-axis calibration (intensity correction by a calibration)
</p></li><li><p>
baseline removal
</p></li><li><p>
smoothing
</p></li><li><p>
cropping (in order to drop uninteresting areas of the spectrum)
</p></li><li><p>
resampling (changing the x-axis resolution)
</p></li><li><p>
normalization
</p></li></ul><p>
Altaxo features a spectral preprocessing pipeline, implementing the steps described above.
</p><h4 id="A2E8B94B1967BE06A19ABF377DF49913">Usage</h4><p>
Import one or multiple spectra. If the spectra should be treated with the same preprocessing steps, it is preferable to import them into a single worksheet.
</p><p>
Select all columns in that worksheet which contains the intensities. Do not select the x-columns containing the wavelengths.
</p><p>
Use the menu <span class="code">Analysis</span> → <span class="code">Spectroscopy</span> → <span class="code">Preprocess</span> to open the <a href="C05A56A60B14F185E807BF8B9E97276F.htm#Screenshot_Dialog_SpectralPreprocessing">preprocessing dialog</a>. The preprocessing dialog contains multiple tabs for the preprocessing steps described above. Each tab allows the selection of different preprocessing methods for its topic. Each tab contains a 'None' method, which essentially means, that when selected, nothing is being done in that step.
</p><p><a href="ACAC6A80-7CE0-4CB9-B36C-B2FB6ACAB027.htm#DA7025B97C912381099AADEDBE063E94"><img src="../media/DA7025B97C912381099AADEDBE063E94.png" width="378"></img></a></p><p>
Fig.1: Spectral preprocessing dialog with tabs for various steps
</p><p>
After selection of the required methods and pressing <span class="code">OK</span>, a new worksheet is created, which contains the preprocessed spectra. The name of the new worksheet is the name of the original worksheet with the string <span class="code">_preprocessed</span> appended to it.
</p><p>
The newly created table contains a data source for the preprocessing. The data source remembers where the data of the preprocessing came from, and which preprocessing steps have been performed. If the result of the preprocessing is not satisfactory, the data source can be opened by clicking on the question mark <span class="mediaInline"><artLink target="Icons.16x16" /></span> in the toolbar. Using this <a href="C05A56A60B14F185E807BF8B9E97276F.htm#Screenshot_Dialog_SpectralPreprocessingDataSource">dialog</a>, the preprocessing steps can be changed, or data can be added or removed.
</p><p><a href="ACAC6A80-7CE0-4CB9-B36C-B2FB6ACAB027.htm#59174AE6FA8C8A4E3A404AA8CE24D641"><img src="../media/59174AE6FA8C8A4E3A404AA8CE24D641.png" width="378"></img></a></p><p>
Fig.2: Data source of the worksheet containing the preprocessed spectra. The expander in the center contains the preprocessing options; the expander at the bottom contains the information about the origin of the data to process.
</p><p>
Additionally, when the original data have changed, you can re-apply the preprocessing by clicking on the <span class="code">Requery table data source</span> button <span class="mediaInline"><artLink target="Icons.16x16" /></span> in the toolbar.
</p><p>
In the following sections, the various preprocessing steps are described in more detail.
</p><h4 id="71ADF13B2C31A085ACA5242A5D7F66A3">Spike removal</h4><p>
Some spectrometers, for instance Raman spectrometers, need to detect very low intensities. On those spectrometers, radiation coming from cosmic particles and from other sources can hit a pixel of the detector. This will increase the counts of this pixel, often much more than the wanted signal. The excitation is limited to this pixel, or to this and very few neighboring pixels, and thus cause a sharp peak in the spectrum.
</p><p>
Those peaks spoil the further preprocessing of the spectrum, e.g. smoothing, base line correction, and normalization, and therefore needs to be eliminated.
</p><p>
Currently, there is only one method in the Spike removal tab. It is
</p><h4 id="EFF1B46F6F36286A7CEB9E7B2C20267D">SpikeRemovalByPeakElimination</h4><p>
This method has only two parameters (see <a href="C05A56A60B14F185E807BF8B9E97276F.htm#Screenshot_Dialog_SpikeRemovalByPeakElimination">Fig.1</a>):
</p><ol><li><p>
Maximum width in points. The maximum width of the spikes (in pixel) that should be eliminated. Often, a width of 1 is sufficient to remove cosmic spikes. If neighboring pixels are also affected, the width parameter can be increased. Please be aware that this increases the risk that wanted peaks are eliminated, too.
</p></li><li><p>
Eliminate negative spikes: For background removal, often a dark spectrum is subtracted from the measured spectrum. If the dark spectrum contains cosmic spikes, then these will appear in the resulting spectrum as negative spikes. If negative spikes occur in the spectrum, the checkbox should be checked. If not removed, negative spikes will spoil mainly the baseline correction step, and the normalization step.
</p></li></ol><p><a href="ACAC6A80-7CE0-4CB9-B36C-B2FB6ACAB027.htm#F7A2C57AA0C565C9725FA4C71BAF574E"><img src="../media/F7A2C57AA0C565C9725FA4C71BAF574E.png" width="454"></img></a></p><p>
Fig. 1: Dialog for the SpikeRemovalByPeakElimination step
</p><h4 id="4A3CCEBD57EEE2A0A37F4439C7C9235F">Calibration</h4><p>
This tab allows you to change the x-axis of your spectrum from an uncalibrated x-axis to a calibrated x-axis.
</p><p>
The prerequisite for this is the presence of a table which contains a valid x-calibration. Such a table can be created for instance for Raman instruments using a spectrum of a Neon lamp and a Raman spectrum of silicon (see <a href="C05A56A60B14F185E807BF8B9E97276F.htm#Section_RamanSpectroscopy_CalibrationWithNeonAndSi">Raman calibration with Neon and Silicon</a>).
</p><p>
Using this calibration table to change the x-axis of the spectrum is straightforward (see <a href="C05A56A60B14F185E807BF8B9E97276F.htm#Screenshot_SpectralPreprocessing_CalibrationTab">Fig. 1</a>): In the combobox all tables that contain a valid x-calibration are listed, and the most recent calibration is preselected. Simply choose the table that contains the calibration you want to apply.
</p><p><span class="mediaInline"><img alt="62FBA46291980305A138D8898E0A40E8" src="../media/62FBA46291980305A138D8898E0A40E8.png" /></span></p><p>
Fig. 1: Calibration tab. The combobox lists all tables containing calibrations, and the most recent calibration is preselected.
</p><h4 id="A2B6C76E0EF48B1F92A3F359742A2E70">Smoothing</h4><p>
The smoothing step will apply some smoothing algorithm to the spectral data in order to reduce the noise level.
</p><p>
Currently, only one smoothing method is implemented:
</p><h4 id="6F76AE7AC9866B046CEA1AC5914C28A8">Smoothing by Savitzky-Golay</h4><p>
The method uses the Savitzky-Golay method to smooth a signal. Basically, it is a local polynomial fit, of which the center fit value is used as replacement for the original point. As an additional option, not only the center fit value, but also the derivative at that point can be used (but note that the x-values are not used to calculate the derivative value).
</p><p>
Savitzky-Golay has the following options:
</p><ul><li><p>
Number of points: The number of points for the local fit. The more points, the smoother the result, but the more the original shape of the spectrum is changed.
</p></li><li><p>
Polynomail order: The polynomial order of the fit. The default value of 2 means that a quadratic fit is applied.
</p></li><li><p>
Derivative order: The default value of 0 means the central fit function value is used to replace the original point. A value of 1 means the first derivative is used, etc. Note that the result is not the true derivative, since the x-values are not used for evaluation of the derivative (the space between the points is assumed to be 1).
</p></li></ul><h4 id="514EA5091C8DCC6FA4E17689BB967993">Baseline</h4><p>
Baseline correction is essential, because some of the subsequent methods, for instance some of the peak fitting methods, assume that the baseline was corrected before, so that the base of the peaks can be assumed to be zero.
</p><p>
Different baseline correction methods exist, but non of them is waterproof. The reason is simply, that there is information missing. Assume your entire spectrum consists of massive overlapping peaks, there is no way to determine a baseline, because each spectral point has intensity from at least one peak.
</p><p>
The methods described below therefore assime that at least in some regions of the spectrum there are no neighboring peaks, and the intensity in those regions is at its base level.
</p><h4 id="ED173FC9BAAD3CAF403EE4041F4438A4">AirPLS, ALS, ArPLS</h4><p>
These are methods based on diffusion equations. Thus all methods exhibit a diffusion constant lamda. The higher lambda is, the more flat is the resulting baseline. This group of methods is especially well suited if the spectrum exhibits a high noise level, but require some manual adjustment of the parameters by trial-and-error.
</p><p>
References:<br />
[1] Zhang ZM, Chen S, Liang YZ. "Baseline correction using adaptive iteratively reweighted penalized least squares", Analyst. 2010 May; 135(5):1138-46, Epub 2010 Feb 19. PMID: 20419267, <a href="https://doi.org/10.1039/b922045c" target="_blank" rel="noopener noreferrer">https://doi.org/10.1039/b922045c</a></p><p>
[2] Sung-June Baek, Aaron Park, Young-Jin Ahn and Jaebum Choo, "Baseline correction using asymmetrically reweighted penalized least squares smoothing", Analyst, 2015, 140, 250-257, <a href="https://doi.org/10.1039/C4AN01061B" target="_blank" rel="noopener noreferrer">https://doi.org/10.1039/C4AN01061B</a></p><p>
[3] Paul H.C. Eilers, Hans F.M. Boelens, "Baseline Correction with Asymmetric Least Squares Smoothing", October 21, 2005
</p><h4 id="05C10DC19DB545D039C95E45548CBA99">PolynomialDetrending</h4><p>
Strictly speaking, this is not a method to guess the baseline, since the entire  spectrum is used for evaluation. The method evaluates a polynomial fit of user-defined order of the entire spectrum. The resulting polynomial is then used as the baseline. The method may perform good if only very few and narrow peaks exist in the spectrum. The method requires a user defined parameter: the detrending order. Choose a value of
</p><ul><li><p>
0 for subtracting a constant (in this case, the mean of the y-values)
</p></li><li><p>
1 for subtracting a linear slope
</p></li><li><p>
2 for subtracting a quadratic function
</p></li></ul><h4 id="48C937B811E414CCBD9F2925520948FF">SNIP (linear and loglog)</h4><p>
This implements the SNIP algorithm. Basically, the method spans a line between two spectral points. The width of the line is defined by the user, but must be an odd number of spectral points. The resulting baseline point is then either used from the spectrum (if the center of the line lies above the spectrum), or from the center of the line (if the center of the line lies below the spectrum). This is repeated for a fixed number of iterations.
</p><p><em>SNIPLinear</em> is using the original spectral y-values, whereas <em>SNIPLogLog</em> first takes twice the logarithm of the y-values, which presumes that the y-values are all positive.
</p><p>
The following options are available:
</p><ul><li><p>
Half width: the half of the (width of the line described above minus 1). Thus, a value of 1 means the width of the line is 3 points; a value of 10 means a line width of 21 points. The half width can also be entered in units of the x-axis of the spectrum. The value of the half width should be at least that of the full (!) width of the broadest peak in the spectrum.
</p></li><li><p>
Number of iterations: The default value of 40 is appropriate for most applications.
</p></li></ul><p>
References:
</p><p>
[1] C.G. Ryan, E. Clayton, W.L. Griffin, S.H. Sie, D.R. Cousens,
"SNIP, a statistics-sensitive background treatment for the quantitative analysis of PIXE spectra in geoscience applications",
Nuclear Instruments and Methods in Physics Research Section B: Beam Interactions with Materials and Atoms, Volume 34, Issue 3, 1988, pp. 396-402, ISSN 0168-583X,
<a href="https://doi.org/10.1016/0168-583X(88)90063-8" target="_blank" rel="noopener noreferrer">https://doi.org/10.1016/0168-583X(88)90063-8</a></p><h4 id="49CC97E04C09226C13D568F0BE3E83BD">Cropping</h4><p>
Cropping selects only the interesting part of the spectrum.
</p><p>
The different methods are:
</p><h4 id="0B521A5A75031347F8903D8DDD630937">Cropping by indices</h4><p>
Here, the minimal index and the maximal index of the points that should be includes in the spectrum are given. Note that indexing is zero based: If the first point should be included, the minimal index has to be set to 0. Negative indices are allowed too, designating then the offset from the point after the last point. Thus a value of -1 represents the last point, -2 the point before the last point etc.
</p><p><span class="mediaInline"><img alt="A5544AC0E3871B42108293DBE68E48D7" src="../media/A5544AC0E3871B42108293DBE68E48D7.png" /></span></p><p>
Fig. 1: Dialog for cropping by indices. Because here the minimal index is 0, meaning the first point, and the maximal index is -1, meaning the last point, the entire spectrum is included (which is the same as choosing <span class="code">CroppingNone</span>)
</p><h4 id="CD760D0CCB5120EBE6821ECBB619CDBF">Cropping by x-values</h4><p>
The range of the spectrum that should be included is given in units of the x-axis of the spectrum. By default, the minimal value is -∞ and the maximal value ∞, meaning that the entire spectrum is included, but minimal value and maximal value can be adjusted.
</p><p><span class="mediaInline"><img alt="D06BD2F4DC5536928827C382815E33F3" src="../media/D06BD2F4DC5536928827C382815E33F3.png" /></span></p><p>
Fig. 2: Dialog for cropping a spectrum by providing the minimum and maximum x-value. Here, the minimum x-value is given as 300, whereas the maximum value is left at infinity.
</p><h4 id="15378655FFBECB8F543714896C24AC0E">Resampling by interpolation</h4><p>
This method combines cropping with a resampling of the x-axis. Resampling means changing the x-axis points to new values, thereby enhancing the x-value spacing or decreasing it. It is often used to make the x-axis values equidistant again (for instance after applying x-calibration). In order to get the y-values at new x-values, the values needs to be interpolated between to existing points.
</p><p>
This method has a bunch of different options:
</p><ul><li><p>
Interpolation method: Choose a interpolation method. Different types of splines are available, even smoothing splines, which require additional parameters to be entered.
</p></li><li><p>
Sampling: Basically, the start value, the end value and the number of points are needed. But the dialog allows to choose between different options here:
</p><ul><li><p>
specifying the x-values by start, end and count (number of points)
</p></li><li><p>
specifying the x-values by start, end and step value
</p></li><li><p>
specifying the x-values by start, step value and count
</p></li><li><p>
specifying the x-values by end, count and step value
There is a preview box that shows the first three and the last three x-values that would be generated by your choice.
</p></li></ul></li></ul><p><span class="mediaInline"><img alt="F3DA522D5FDBB7B50EBC337E675410B1" src="../media/F3DA522D5FDBB7B50EBC337E675410B1.png" /></span></p><p>
Fig. 3: Dialog for resampling by interpolation.
</p><h4 id="372703E7C9A000EDF46FDDD85CBB05B3">Normalization</h4><p>
Normalization scales the y-values of the spectrum according to different algorithms.
</p><p><a href="ACAC6A80-7CE0-4CB9-B36C-B2FB6ACAB027.htm#BA6AF25020159D0D38C39A5E8AAE924A"><img src="../media/BA6AF25020159D0D38C39A5E8AAE924A.png" width="454"></img></a></p><p>
Fig.1 Normalization tab with different options for normalization.
</p><p>
The different options for normalization are described in the following sections.
</p><h4 id="21346CD80A08CEC324411A02B92EB0F7">NormalizationArea</h4><p>
Executes area normalization:
</p><a href="ACAC6A80-7CE0-4CB9-B36C-B2FB6ACAB027.htm#834B7BCD8BC47A668CF67EF4155AA1AC"><img src="../media/834B7BCD8BC47A668CF67EF4155AA1AC.png" width="91" height="32"></img></a><p>
in which <a href="ACAC6A80-7CE0-4CB9-B36C-B2FB6ACAB027.htm#7339213FADD5CC41BF561F5F4FA6844A"><img src="../media/7339213FADD5CC41BF561F5F4FA6844A.png" width="28" height="10" style="vertical-align:0px;"></img></a> is the minimal y-value and <a href="ACAC6A80-7CE0-4CB9-B36C-B2FB6ACAB027.htm#9DCF853E6A4E4533EC089976BA658819"><img src="../media/9DCF853E6A4E4533EC089976BA658819.png" width="38" height="7" style="vertical-align:0px;"></img></a> is the average of all y-values. This results in a spectrum for which:
</p><ul><li><p>
the minimal y-value is 0
</p></li><li><p>
the sum of all y-values is 1
</p></li></ul><h4 id="F4855935518B4D8627891DA5A2AAFFF1">NormalizationMinMax</h4><p>
Executes min-max normalization:
</p><a href="ACAC6A80-7CE0-4CB9-B36C-B2FB6ACAB027.htm#717453749F4D659EC3A0ADB327CA469A"><img src="../media/717453749F4D659EC3A0ADB327CA469A.png" width="114" height="33"></img></a><p>
in which <a href="ACAC6A80-7CE0-4CB9-B36C-B2FB6ACAB027.htm#7339213FADD5CC41BF561F5F4FA6844A"><img src="../media/7339213FADD5CC41BF561F5F4FA6844A.png" width="28" height="10" style="vertical-align:0px;"></img></a> and <a href="ACAC6A80-7CE0-4CB9-B36C-B2FB6ACAB027.htm#1F4F924B50772A0F41A5933B488B2C3C"><img src="../media/1F4F924B50772A0F41A5933B488B2C3C.png" width="30" height="7" style="vertical-align:0px;"></img></a> are the minimal and the maximal y-values, respectively. This results in a spectrum for which:
</p><ul><li><p>
the minimal y-value is 0
</p></li><li><p>
the maximal y-value is 1
</p></li></ul><h4 id="D410038C915CC40ED66BF21F7715F535">NormalizationMinMaxInRange</h4><p>
Executes min-max normalization, but for determination of <a href="ACAC6A80-7CE0-4CB9-B36C-B2FB6ACAB027.htm#7339213FADD5CC41BF561F5F4FA6844A"><img src="../media/7339213FADD5CC41BF561F5F4FA6844A.png" width="28" height="10" style="vertical-align:0px;"></img></a> and <a href="ACAC6A80-7CE0-4CB9-B36C-B2FB6ACAB027.htm#1F4F924B50772A0F41A5933B488B2C3C"><img src="../media/1F4F924B50772A0F41A5933B488B2C3C.png" width="30" height="7" style="vertical-align:0px;"></img></a>, only a user-defined region of the spectrum is used:
</p><a href="ACAC6A80-7CE0-4CB9-B36C-B2FB6ACAB027.htm#717453749F4D659EC3A0ADB327CA469A"><img src="../media/717453749F4D659EC3A0ADB327CA469A.png" width="114" height="33"></img></a><p>
in which <a href="ACAC6A80-7CE0-4CB9-B36C-B2FB6ACAB027.htm#7339213FADD5CC41BF561F5F4FA6844A"><img src="../media/7339213FADD5CC41BF561F5F4FA6844A.png" width="28" height="10" style="vertical-align:0px;"></img></a> and <a href="ACAC6A80-7CE0-4CB9-B36C-B2FB6ACAB027.htm#1F4F924B50772A0F41A5933B488B2C3C"><img src="../media/1F4F924B50772A0F41A5933B488B2C3C.png" width="30" height="7" style="vertical-align:0px;"></img></a> are the minimal and the maximal y-values in the user defined region, respectively. This results in a spectrum for which:
</p><ul><li><p>
the minimal y-value is 0 in the user defined region
</p></li><li><p>
the maximal y-value is 1 in the user defined region
</p></li><li><p>
the y-values outside the user defined region are affected, too, but can be less than 0 or greater than 1
</p></li></ul><p>
Use this normalization technique e.g. if there is a well defined reference peak, and the rest of the spectrum should be scaled to that reference peak. In this case, the user-defined region should include the maximum of the reference peak, but also the base(s) of that peak.
</p><p><span class="mediaInline"><img alt="1AC86D8DD5880C738FCF8B35197EE3DC" src="../media/1AC86D8DD5880C738FCF8B35197EE3DC.png" /></span></p><p>
Fig. 2: The normalization method <span class="code">NormalizationMinMaxInRange</span> requires the input of the range of x-values of the user defined region.
</p><h4 id="EE15CE5870351377D2CB2DF3D0685665">NormalizationStandardNormalVariate</h4><p>
Executes SNV (standard  normal variate) normalization:
</p><a href="ACAC6A80-7CE0-4CB9-B36C-B2FB6ACAB027.htm#DD2511DA99C1C02244FF934A320EC293"><img src="../media/DD2511DA99C1C02244FF934A320EC293.png" width="101" height="30"></img></a><p>
in which <a href="ACAC6A80-7CE0-4CB9-B36C-B2FB6ACAB027.htm#9DCF853E6A4E4533EC089976BA658819"><img src="../media/9DCF853E6A4E4533EC089976BA658819.png" width="38" height="7" style="vertical-align:0px;"></img></a> is the average of all y-values and <a href="ACAC6A80-7CE0-4CB9-B36C-B2FB6ACAB027.htm#424EB68FF5BF6809ECC21BB486C5F3C7"><img src="../media/424EB68FF5BF6809ECC21BB486C5F3C7.png" width="21" height="11" style="vertical-align:0px;"></img></a> is the standard deviation of the y-values.
</p><p>
This results in a spectrum for which:
</p><ul><li><p>
the sum of all y-values and the average is 0
</p></li><li><p>
the standard deviation of the y-values is 1
</p></li></ul><h4 id="81A4739BAB743541F5891D0D7C07A1C0">NormalizationVector</h4><p>
Executes vector normalization:
</p><a href="ACAC6A80-7CE0-4CB9-B36C-B2FB6ACAB027.htm#352448A56C4F831C754051DFC4394DD2"><img src="../media/352448A56C4F831C754051DFC4394DD2.png" width="75" height="28"></img></a><p>
in which <a href="ACAC6A80-7CE0-4CB9-B36C-B2FB6ACAB027.htm#E79466CD8284DC2C6469109439A0FBD6"><img src="../media/E79466CD8284DC2C6469109439A0FBD6.png" width="37" height="7" style="vertical-align:0px;"></img></a> is the L2 norm of the y-values, i.e.
</p><a href="ACAC6A80-7CE0-4CB9-B36C-B2FB6ACAB027.htm#B2EF5B5E652E4CE3DF0FE3031650B146"><img src="../media/B2EF5B5E652E4CE3DF0FE3031650B146.png" width="109" height="28"></img></a><p>
This results in a spectrum for which:
</p><ul><li><p>
the L2 norm of the y-values is 1
</p></li></ul></div><div class="collapsibleAreaRegion" id="Section_PeakSearchingAndFitting"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('IDDAB')" onkeypress="SectionExpandCollapse_CheckKey('IDDAB', event)" tabindex="0"><img id="IDDABToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Peak searching and fitting</span></div><div id="IDDABSection" class="collapsibleSection"><p>
It may be interesting to know the positions, widths, and heights (or areas) of the peaks of a spectrum.
</p><p>
Peak searching and fitting usually consist of three steps (there is one exception, which will be described later):
</p><ol><li><p>
a peak searching algorithm searches for peaks and outputs the approximate positions, widths and heights of the found peaks
</p></li><li><p>
the approximate positions, widths and heights that are the result of the peak searching step are used as initial values for peak fitting. Then a peak fitting algorithm evaluates these values with a higher accuracy. Other quantities, like the area under the peak, can be output, too.
</p></li><li><p>
Output the results in a new worksheet, and (optionally) plot the fit curve together with the original spectral data.
</p></li></ol><p>
Altaxo features a peak searching and fitting pipeline, implementing the two steps described above.
</p><h4 id="07AA43B8A6B502F03DCBADA754FAFAB3">Usage</h4><p>
Import one or multiple spectra. If the spectra should be treated with the same steps, it is preferable to import them into a single worksheet.
</p><p>
Select all columns in that worksheet which contains the spectral intensities. Do not select the x-columns containing the wavelengths.
</p><p>
Use the menu <span class="code">Analysis</span> → <span class="code">Spectroscopy</span> → <span class="code">PeakFinding+Fitting</span> to open the <a href="C05A56A60B14F185E807BF8B9E97276F.htm#Screenshot_Dialog_SpectralPeakSearchingAndFitting">peak finding+fitting dialog</a>. The dialog contains multiple tabs. The first tabs are for the preprocessing steps described in section <a href="C05A56A60B14F185E807BF8B9E97276F.htm#Section_SpectralPreprocessing">Spectral Preprocessing</a>. The last three tabs contain options for the search step, the fit step, and the output step described above.
</p><p><a href="ACAC6A80-7CE0-4CB9-B36C-B2FB6ACAB027.htm#2B612A7929B25F51C02AE1916524AAC0"><img src="../media/2B612A7929B25F51C02AE1916524AAC0.png" width="567"></img></a></p><p>
Fig.1: Spectral preprocessing dialog with three additional steps for peak searching, fitting and output of the results.
</p><p>
After selection of the required methods and pressing <span class="code">OK</span>, a new worksheet is created, which contains the result of the peak searching and peak fitting. The name of the new worksheet is the name of the original worksheet with the string <span class="code">_peaks</span> appended to it.
</p><p>
The newly created table contains a data source for the peak searching+fitting. The data source remembers where the data for peak searching + fitting came from, and which options have been used. If the result of the peak searching + fitting is not satisfactory, the data source can be opened by clicking on the question mark <span class="mediaInline"><artLink target="Icons.16x16" /></span> in the toolbar. Using this <a href="C05A56A60B14F185E807BF8B9E97276F.htm#Screenshot_Dialog_SpectralPreprocessingDataSource">dialog</a>, the steps can be changed, or data can be added or removed.
</p><p><a href="ACAC6A80-7CE0-4CB9-B36C-B2FB6ACAB027.htm#F83158184139B75F2B52FFEB0D11AFA6"><img src="../media/F83158184139B75F2B52FFEB0D11AFA6.png" width="567"></img></a></p><p>
Fig.2: Data source of the worksheet containing the peak data. The expander in the center contains the preprocessing and peak searching+fitting options; the expander at the bottom contains the information about the origin of the data to process.
</p><p>
Additionally, when the original data have changed, you can re-apply the preprocessing by clicking on the <span class="code">Requery table data source</span> button <span class="mediaInline"><artLink target="Icons.16x16" /></span> in the toolbar.
</p><p>
In the following sections, the options for the peak searching, peak fitting, and output steps are described in more detail.
</p><h4 id="9EA2614F8D1BA205B900FD8512335A12">Peak searching</h4><p>
Currently, two methods for peak searching are implemented:
</p><ol><li><p>
Peak searching by topology search
</p></li><li><p>
Peak searching by continuous wavelet transformation
</p></li></ol><p>
Peak searching by topology is faster than peak searching by continuous wavelet transformation. But it has problems when peaks are overlapping, for instance a peak is located in the shoulder of another peak.
Essentially, you can use peak searching by topology for spectra with well separated peaks and a low noise level.
For all other cases, peak searching by continuous wavelet transformation is the better choice.
</p><h4 id="7844A07423CFE174A70AEBD57F2F962E">Peak searching by topology</h4><p>
In this method, all local maxima of the spectral signal are searching. Basically, each local maximum is a peak, but usually these candidates are filtered out further; otherwise each local maxima caused by noise would appear in the result.
Filter criteria are e.g. the height of the peak (peaks under a threshold height are dropped), the prominence of a peak (peaks under a certain prominence level are dropped), or the width (peaks below a certain width or above a certain width) are dropped.
</p><p><a href="ACAC6A80-7CE0-4CB9-B36C-B2FB6ACAB027.htm#73FAA6654DF169E6F1669CA6F26A6319"><img src="../media/73FAA6654DF169E6F1669CA6F26A6319.png" width="378"></img></a></p><p>
Fig. 1: Explanation of height and prominence value of the peak at x = 1500.
</p><p>
In Altaxo, only two options can be chosen:
</p><ul><li><p>
Minimal prominence: Designates the minimal prominence value of the peak. This is a relative value related to the y-span of the spectrum. The y-span of the spectrum is the difference of the highest intensity value and the lowest intensity value.
</p></li><li><p>
Maximum number of peaks: Designates the maximum number of resulting peaks. If more peaks than this number are found, the peaks with the lowest prominence values are dropped, and only this number of peaks is included in the output.
</p></li></ul><p><a href="ACAC6A80-7CE0-4CB9-B36C-B2FB6ACAB027.htm#352D67BEF89DB05D7BA8281FF5216B2E"><img src="../media/352D67BEF89DB05D7BA8281FF5216B2E.png" width="567"></img></a></p><p>
Fig. 1: Options for 'Peak searching by topology'.
</p><h4 id="04B77A95095FFC30ED499B6EE3F25D61">Peak searching by continuous wavelet transformation</h4><p>
Peak searching by continuous wavelet transformation uses <a href="https://en.wikipedia.org/wiki/Continuous_wavelet_transform" target="_blank" rel="noopener noreferrer">continuous wavelet transformation</a> (CWT) to convolve the spectrum with a wavelet. In this case, the wavelet is a Ricker wavelet (also known as Mexican hat). Since the width of the peaks is not known at the beginning, the convolution has to be performed with the Ricker wavelet of different x-scales. The basic idea is, that the result of the convolution is maximal, if the width of the Ricker wavelet approximately corresponds with the width of the peak, and the center location of the wavelet and of the peak fall together. Around this maximum value, there is a mountain with very steep slopes in the "location" direction, but a ridge line in the "broadness of the wavelet" direction (<a href="C05A56A60B14F185E807BF8B9E97276F.htm#Graph_PeakSearchingByCwt_RidgeLine3D">Fig. 2</a>).
</p><p>
The algorithm starts with a very narrow Ricker wavelet (which has a width of 1 point), and convolutes this with the signal. In each of the subsequent steps, the Ricker wavelet is made broader, and convoluted again with the signal. When the broadness of the wavelet exceeds the range of the entire spectrum, the algorithms stops. After this, ridge lines are detected. Each ridge line can correspond to a peak in the spectrum, but there are also some ridge lines that do not correspond to a peak. Therefore the ridge lines are filtered out using some criteria shown <a href="C05A56A60B14F185E807BF8B9E97276F.htm#Screenshot_PeakSearchingByCwt">below</a>.
</p><p><a href="ACAC6A80-7CE0-4CB9-B36C-B2FB6ACAB027.htm#133CFFCD49047B3108B99E21804F35F0"><img src="../media/133CFFCD49047B3108B99E21804F35F0.png" width="378"></img></a></p><p>
Fig. 2: Example of a spectrum that is used for CWT transformation, see below.
</p><p><a href="ACAC6A80-7CE0-4CB9-B36C-B2FB6ACAB027.htm#B0CC2B678D2C3D6372A1FBB804B18B4C"><img src="../media/B0CC2B678D2C3D6372A1FBB804B18B4C.png" width="567"></img></a></p><p>
Fig. 2: CWT transformation of the spectrum shown above. The ridge line and its maximum of the largest peak (at x = 2000) is labelled. To the left (at x = 1000) there is a second, much smaller ridge corresponding to the peak at x = 1000.
</p><p><a href="ACAC6A80-7CE0-4CB9-B36C-B2FB6ACAB027.htm#8F1F1377757AB229329C78A23FA4D534"><img src="../media/8F1F1377757AB229329C78A23FA4D534.png" width="605"></img></a></p><p>
Fig. 3: Options for 'peaks searching by continuous wavelet transformation'.
</p><p>
The <a href="C05A56A60B14F185E807BF8B9E97276F.htm#Screenshot_PeakSearchingByCwt">dialog</a> contains various options, but most of them can be left at their default values:
</p><ul><li><p>
Wavelet: Choose between a Ricker wavelet, and a wavelet which is the 2nd derivative of the Ricker wavelet. The latter will enhance peaks located in shoulders of other peaks somewhat more.
</p></li><li><p>
Points per octave: The default value 8 means the Ricker wavelet is made broader in steps of <a href="ACAC6A80-7CE0-4CB9-B36C-B2FB6ACAB027.htm#14D6625A4838B2B3100E065DA520CF7A"><img src="../media/14D6625A4838B2B3100E065DA520CF7A.png" width="24" height="15" style="vertical-align:0px;"></img></a>, i.e. after 8 steps the wavelet is twice as broad as before. The more points, the finer is the resolution of the determination of the peak width, but more steps require more evaluation time.
</p></li><li><p>
Minimal length of ridge line. The minimal length of a ridge line that is required for the detection of a peak. The default value of 200% means that the ridge line must at least be 2 octaves long in order to be considered as a peak candidate.
</p></li><li><p>
Minimal width of ridge peak (octaves). When following a ridge line, there is a maximum value, which is when the width of the wavelet is (roughly) equal to the width of the peak. The default value of 200% means that around that peak there should be no local maxima one octave higher and one octave lower. This will e.g. suppress local maxima on the ridge line caused by noise.
</p></li><li><p>
Minimal signal-to-noise ratio: The value of the maximum on a ridge line must be considerably higher than the noise level in order to be the ridge line considered as a peak candidate. The default value of 300% means that the peak maximum must be 3 times higher than the noise level. Increasing this value will decrease the number of detected peaks, decreasing it will increase the number of detected peaks, but can cause to detect peaks, which are essentially noise.
</p></li><li><p>
Minimal relative Gaussian amplitude: After a peak is detected and located, the amplitude of it (back in the signal domain) can be determined. The default value of 0.5% means that only those peaks are included in the result, that have a height which is at least 0.5% the y-span of the signal (difference of the signal maximum and the signal minimum values).
</p></li><li><p>
Maximal number of peaks: Designates the maximum number of resulting peaks. If more peaks than this number are found, the peaks with the lowest height values are dropped, and only this number of peaks is included in the output.
</p></li></ul><p>
References:
</p><p>
[1] Pan Du, Warren A. Kibbe, Simon M. Lin, "Improved peak detection in mass spectrum by incorporating continuous wavelet transform-based pattern matching", Bioinformatics Volume 22, Issue 17, August 2006 pp 2059–2065, <a href="https://doi.org/10.1093/bioinformatics/btl355" target="_blank" rel="noopener noreferrer">https://doi.org/10.1093/bioinformatics/btl355</a></p><p>
[2] Chao Yang, Zengyou He, Weichuan Yu, "Comparison of public peak detection algorithms for MALDI mass spectrometry data analysis",  BMC Bioinformatics 10, 4 (2009), <a href="https://doi.org/10.1186/1471-2105-10-4" target="_blank" rel="noopener noreferrer">https://doi.org/10.1186/1471-2105-10-4</a></p><h4 id="C1488F91AC57FD6CDF6410EACF08A882">Peak fitting</h4><p>
After the peak searching step, the resulting approximate positions, widths, and heights of the peaks can be used as initial values for a subsequent peak fitting step.
</p><p>
Different fitting methods exists, which are described in the following.
</p><h4 id="459C55078FB0F0682ECC84C844E9FE4E">Peak fitting by incremental peak addition</h4><p>
The method starts by searching the spectrum for the highest peak. Approximate position, width, and height of this peak is used as initial values for a fit function that contains only this peak and a baseline of user-defined polynomial order. The fit is executed. After fitting this peak, the fit function values are subtracted from the original spectrum (calculating the residual of the fit). In this residual, the highest peak is searched again. The position, width and height of the previous fit plus the approximate position, width, and height of the new peak is used as initial values for a fit function which has one more peak than the previous one. The fit is executed again. The process is repeated, adding more and more peaks, until a certain number of peaks are reached, or another stop criterion is fulfilled.
</p><blockquote><p><strong>Note:</strong><br />
For the fitting method <span class="code">PeakFittingByIncrementalPeakAddition</span> the peak searching step is not required. Please leave peak searching at the default value of topology search. Furthermore, baseline correction is also not required, since the fit function itself contains a polynomial baseline.
</p></blockquote><p>
The options for this method are:
</p><ul><li><p>
Fit function: Choose the appropriate fit function.
</p></li><li><p>
Order of baseline polynomial. Use a value of -1 for no baseline, a value of 0 for a constant baseline, 1 for a linear baseline. Values greater than 1 are possible too, but not recommended.
</p></li><li><p>
Max. number of peaks: The maximum number of peaks that the fit function uses. The addition of peaks stops when this number is reached. Note that the final number of peaks can be less than this number, because after the fitting step, a pruning step follows, dropping the most insignificant peaks.
</p></li><li><p>
Minimal relative height: The addition of peaks stops, if the highest peak in the residual has a height that is less the given factor times the original y-span of the spectrum (which is the difference of maximum y-value and minimum y-value of the spectrum).
</p></li><li><p>
Minimal signal to noise: The addition of peaks stops, if the highest peak in the residual has a height that is less the given factor times the noise level.
</p></li><li><p>
Minimal peak FWHM: If you know the resolution properties of your spectrometer, you can give here the minimal Full-Width-Half-Maximum value that a peak could reach. You can enter this value in points (checkbox cleared), or in the x-units of the spectrum (checkbox checked).
</p></li><li><p>
Prune peaks factor: After the fitting, the most insignificant peaks can be dropped (i.e. not included in the result). This is done based on the Chi² value of the fit. The default value of 10% means, that peaks are dropped, as long as the new Chi² value of the fit remains below (100% + 10%) = 110% of the original Chi² value. Simply speaking, by dropping some peaks, the fit can go worse by 10%.
</p></li><li><p>
Separate error evaluation with relative fit width: This choice only affects how the parameter errors (but not the parameter values itself) are calculated. For details see section <a href="C05A56A60B14F185E807BF8B9E97276F.htm#Section_PeakFitting_SeparateErrorEvaluation">"separate error evaluation for each peak"</a>.
</p></li></ul><p>
Depending on the maximum number of peaks, and the complexity of the fit function, the evaluation can take considerable time, so please be patient! The advantage is, that by increasing the maximum number of peaks, you can model more and more details of your spectrum, leading to very precise fits.
</p><p>
Reference:
</p><p>
[1] Frank Alsmeyer, Wolfgang Marquardt, "Automatic generation of peak shaped models", Appl. Spectroscopy 58, 986-994 (2004), <a href="https://doi.org/10.1366/0003702041655421" target="_blank" rel="noopener noreferrer">https://doi.org/10.1366/0003702041655421</a></p><h4 id="8935E615A2F40B9F83D6A3EF83EA1D3E">Peak fitting separately</h4><p>
This method uses the result of the previous peak searching step. It assumed that each peak is well separated from the neighboring peaks, so that the peak reaches to the left and to the right (nearly) a value of zero.
</p><blockquote><p><strong>Note:</strong><br />
The method assumes that the spectrum is baseline corrected, i.e. that the peak falls down to the left and to the right to a value of zero! Please use an appropriate baseline correction method.
</p></blockquote><p>
The method fits each peak separately. If say the peak searching step results in 80 peaks, then 80 different fits are made, each with a fit function which contains only one peak.
</p><p>
This method has the following options:
</p><ul><li><p>
Fit function: Choose the appropriate fit function.
</p></li><li><p>
Scale fit width by: Only the points in the spectrum in the vicinity of each peak are used for the fit. The default value of 200% means, that the approximate FWHM of the peak (as the result of the peak searching step) is multiplied with a factor of 2. The resulting width is then used for the fit range (i.e. 100% FWHM to the left and 100% FWHM to the right).
</p></li></ul><h4 id="D1CA92779AF48BB9427B2454D83E477C">Peak fitting together (without or with separate variances)</h4><p>
In contrast to the method <span class="code">PeakFittingSeparately</span>, this methods are better suited for peaks that can overlap.
</p><blockquote><p><strong>Note:</strong><br />
The methods assume that the spectrum is baseline corrected, i.e. that if the peaks would not overlap, the peak would falls down to the left and to the right to a value of zero. Thus, the base of the peaks is assumed to be at zero. Please use an appropriate baseline correction method.
</p></blockquote><p>
The method uses the resulting number of peaks from the peak searching step, and the approximate values for position, width, and height of the peaks, to create a fit function with that number of peaks and the initial values for position, width, and height. Then the fit is executed.
</p><p>
This methods have the following options:
</p><ul><li><p>
Fit function: Choose the appropriate fit function.
</p></li><li><p>
Scale fit width by: Only the points in the spectrum in the vicinity of each peak are used for the fit. The default value of 200% means, that the approximate FWHM of the peak (as the result of the peak searching step) is multiplied with a factor of 2. The resulting width is then used for the fit range (i.e. 100% FWHM to the left and 100% FWHM to the right) around a peak. The fit ranges of all peaks are then combined into the final fit range.
</p></li></ul><p>
The differences of the two methods are described in the <a href="C05A56A60B14F185E807BF8B9E97276F.htm#Section_PeakFitting_SeparateErrorEvaluation">next section</a>.
</p><h4 id="Section_PeakFitting_SeparateErrorEvaluation">Separate evaluation of parameter errors for each peak</h4><p>
If you are not interested in the resulting errors of the fit parameters, i.e. errors for position, width, height etc. of the peaks, you can skip this section.
</p><p>
The error of the fit parameters of a nonlinear fit is calculated from the Chi² value of the fit. Basically, it is defined as how much the parameter must be varied, so that the Chi² value becomes twice at high as before.
</p><p>
The problem here: when you make a fit that fits all peaks simultaneously (PeakFittingTogether and PeakFittingByIncrementalPeakAddition), then small peaks will not much contribute to the Chi² value. Which means, that the parameter of those small peaks must be varied unrealistically high in order to double the Chi² value of the fit.
</p><p>
In order to get more realistic error values for the parameters, not the global Chi² value of the fit is used, but the local Chi² value. To calculate the local Chi² value of a peak, only the points in the vicinity of that peak are used for summing up the squared differences between original spectrum and fit function. How many points are included depends on the value of the <span class="code">Scale fit width by</span> value: the default value of 200% means that 200% of the FWHM of the peak (from the peak searching step) is used for calculating the local Chi² value of the peak. When the parameters of that peak are now varied, this local Chi² value is much more influenced (relative to the value before), than the global Chi² value, leading to more realistic results for the parameter errors.
</p><p>
These local Chi² values to calculate the parameter errors are utilized by <span class="code">PeakFittingTogetherWithSeparateVariances</span> (otherwise equal to <span class="code">PeakFittingTogether</span>), and for <span class="code">PeakFittingByIncrementalPeakAddition</span>, if the checkbox <span class="code">Separate error eval. with relative fit width</span> is checked.
</p><h4 id="A08A72142E11F3B42448A53A8D8FA62C">Output</h4><p>
The output of the peak searching and peak fitting steps can be influenced by some options (see <a href="C05A56A60B14F185E807BF8B9E97276F.htm#Screenshot_PeakSearchingAndFitting_OutputOptions">Fig. 1</a>):
</p><ul><li><p>
Output preprocessed curve: if checked, the result of the preprocessing steps (everything except peak searching + fitting) is included in the resulting table.
</p></li><li><p>
Output fit curve: The resulting fit curve is included in the resulting table. Since the fit curve looks better, if it has a higher resolution than the original spectrum, you can choose a sampling factor. A sampling factor of 1 means to include only the original x-values of the spectrum, a sampling factor of 3 adds to additional points between each pair of points of the original spectrum.
</p></li><li><p>
Output separate peak curves: The resulting fit curve is included in the resulting table, but in contrast to the option described above, as separate peaks. In this way, it is easily to see from which peaks the fit curve is composed of. Here too, a sampling factor can be provided to enhance the resolution.
</p></li></ul><blockquote><p>
Note:<br />
Checking <span class="code">Output fit curve</span>, and <span class="code">Output separate peak curves</span> not only include the data in the resulting table, but will also create a graph showing those curves together with the original spectrum. Later, when using this options in the data source of the resulting worksheet again, only the data are included, but the graph(s) will not be created again (of course they will show the changed data if they already exist).
</p></blockquote><p><a href="ACAC6A80-7CE0-4CB9-B36C-B2FB6ACAB027.htm#CA5804C463B5CE04491523EAE54905A9"><img src="../media/CA5804C463B5CE04491523EAE54905A9.png" width="567"></img></a></p><p>
Fig. 1: Dialog for the output options of the preprocessing / peak fitting pipeline.
</p></div><div class="collapsibleAreaRegion" id="FCC125D44CCD76A52BBA4BE955537F85"><span class="collapsibleRegionTitle" onclick="SectionExpandCollapse('IDEAB')" onkeypress="SectionExpandCollapse_CheckKey('IDEAB', event)" tabindex="0"><img id="IDEABToggle" class="collapseToggle" src="../icons/SectionExpanded.png" />Raman spectroscopy</span></div><div id="IDEABSection" class="collapsibleSection"><h4 id="Section_RamanSpectroscopy_CalibrationWithNeonAndSi">Calibration of a Raman device with Neon light and a Silicon wafer</h4><h4 id="304D7A24335AFE382AABCBDA75D782E1">Objective</h4><p>
A Raman device consists of two, at first uncalibrated, parts:
</p><ul><li><p>
The spectrometer. The spectrometer pixels need to be attributed to their corresponding absolute wavelengths.
</p></li><li><p>
The laser. The wavelength of the laser is approximately known, but it is necessary to determine the exact wavelength.
</p></li></ul><p>
The <strong>objective</strong> of the calibration is to calibrate both the spectrometer and determine the absolute laser wavelength. With that information, the x-axis of all spectra measured subsequently could be adjusted to calibrated values.
</p><h4 id="13339967A18C7F4C981F260BEB20D795">What is needed</h4><p>
For that, two measurements are needed:
</p><ol><li><p>
A measurement without laser (to exclude the influence of the laser wavelength). This measurement calibrates the spectrometer. Usually, the light of a small Neon lamp is directed into the Raman instrument, and a spectrum of the Neon light is taken. The position of the Neon bands is known, and with that information the wavelength of the spectrometer pixels can be calibrated.
</p></li><li><p>
A measurement with laser. In this measurement, a sample with a well defined peak, for which the Raman shift is known, is measured. Usually, a polished Silicon wafer is used for this measurement. In combination with the absolute wavelength calibration of the spectrometer with Neon light, the exact wavelength of the Laser light can be calculated.
</p></li></ol><blockquote><p><strong>Tips for measuring the Neon spectrum</strong><br />
Use exactly the same optical path that is used afterwards for measuring the Silicon. Block the laser light. Shine the light of a Neon lamp in your instrument and adjust exposure time to avoid both overexposure and underexposure. Then set the number of accumulations as high as possible to get a low noise level. A low noise level is important to get also the very small peaks close to the left and right sides of the spectrum, because everything outside the range of detected peaks needs to be extrapolated.
</p></blockquote><blockquote><p><strong>Tips for measuring the Silicon spectrum</strong><br />
Make sure the laser is switched on already for some time and now is stable. Adjust the exposure time to avoid both overexposure and underexposure. Set the number of accumulations as high as possible, but avoid too long measurement times because the Silicon is heating up (especially for 785 nm systems). Write down the room temperature (or ideally the temperature of the Silicon wafer). Measure the Silicon and the Neon spectra at the same day.
</p></blockquote><h4 id="7CF66A31262C302A86DC9ADBDAEA45CB">Data evaluation</h4><p>
Load both the Neon spectrum and the Silicon spectrum into an empty worksheet. For that, create an empty worksheet, and then use <span class="code">File → Import → Ascii</span>, or <span class="code">File → Import → SPC </span>or some of the other file import menu points, according to the file format of the spectra. Details on how to import can be find <a href="C05A56A60B14F185E807BF8B9E97276F.htm#Section_ImportOfSpectra">here</a>.
</p><p>
Make sure that the x-axis of both spectra is marked as type "X". Take a look of the Neon spectrum by plotting it.
</p><p><strong>Neon calibration</strong></p><p>
Go back to the worksheet which contains both spectra, select the column with the Neon spectrum, and use the menu <span class="code">Analysis → Spectroscopy → Raman → Neon calibration</span>. A dialog with many options opens, but for a first try, only two things are important:
</p><ul><li><p>
Chose the <strong>unit of the x-axis</strong> of the Neon spectrum you have loaded. In most cases, this would be the Raman shift in cm<sup>-1</sup>.
</p></li><li><p>
If the unit is indeed the Raman shift, the <strong>approximate wavelength of the laser is needed</strong>. Please enter it in the appropriate field (in nanometer). Typical wavelengths are 532 nm, 633 nm and 785 nm, but other systems exist as well.
</p></li></ul><p>
Everything else could be left to default. Press OK to run the Neon calibration. A new worksheet is created, which should contain the calibration. Take a look at the Notes of this worksheet to check for errors during the execution of the calibration.
</p><p>
Typical errors are:
</p><ul><li><p>
The wrong column is selected as x-axis in the worksheet. For instance, many spectra (especially in .txt or .csv format) not only contain a column for the <span class="code">Raman shift</span>, but also a column named <span class="code">Pixel number</span> etc. Thus, maybe column <span class="code">Pixel number</span> is selected as x-axis, but you think the x-axis is 'Raman shift'. You could check which column was used by opening the DataSource of the calibration table, and then check in <span class="code">Neon calibration data 1</span> (or <span class="code">Neon calibration data 2</span> if you are using the second Neon calibration), which x-column is currently used. The mistake of confusing <span class="code">Pixel number</span> with <span class="code">Raman shift</span> is really hard to detect, because on many systems both values are nearly in the same range!
</p></li><li><p>
You have entered the wrong unit of the x-axis of the Neon spectrum. Some reasonability checks are made by the software, and if they fail, an error is reported.
</p></li><li><p>
You have entered the wrong (approximate) wavelength of the laser. For instance, if you have a 785 nm system, but have forgotten to change the laser wavelength (which is by default 532 nm), the calibration will fail. This kind of error could not be detected by the software.
</p></li><li><p>
The Neon spectrum is too noisy, so that too few peaks or too many peaks are detected. Try to adjust some options in the peak finding algorithm. You can use peak detection and finding (menu <span class="code">Analysis → Spectroscopy → PeakDetection &amp; Finding</span>) to search for appropriate settings, and then use those settings for calibration.
</p></li></ul><p><strong>Silicon calibration</strong></p><p>
Next, do the silicon calibration. For this, go back to the worksheet containing the Silicon spectrum, select the column which contains the signal of the Silicon spectrum, and choose the menu point <span class="code">Analysis → Spectroscopy → Raman → Silicon calibration</span>. The options can be left to their defaults, with two exceptions:
</p><ol><li><p>
Enter the <strong>temperature</strong> of the room (or of the silicon wafer if it was measured)
</p></li><li><p>
Make sure that in the combobox <strong>"Calibration table"</strong> that calibration table is selected, which already contains the Neon calibration made before. If you only have one calibration in the entire Altaxo document, the combobox is already showing it, but if you have multiple calibrations, make sure that the right calibration table is selected.
</p></li></ol><p>
Press OK. Now your calibration table should contain a full x-axis calibration. From now on you can use that calibration table in the preprocessing of spectra to adjust the x-axis to a calibrated x-axis.
</p><p><strong>Contents of the calibration table</strong></p><p>
If both the neon as well as the silicon calibration has been successfully performed, the calibration table consist of the following columns:
</p><ul><li><p><span class="code">NistNeonPeakWavelength [nm]</span><br />
Wavelength in nm of the neon peak tabulated in a table from NIST (National institute of Standards and Technology)
</p></li><li><p><span class="code">MeasuredNeonPeakWavelength [nm]</span><br />
Wavelength in nm of the peak that was found in the neon spectrum used for calibration. Please note, that when the original x-axis of the neon spectrum was Raman shift (cm<sup>-1</sup>), then the wavelength was calculated using the approximate laser wavelength that was provided in the neon calibration dialog.
</p></li><li><p><span class="code">DifferenceOfPeakWavelengths [nm]</span><br />
Difference <a href="ACAC6A80-7CE0-4CB9-B36C-B2FB6ACAB027.htm#3D5061F966816E7277657E7708CDD870"><img src="../media/3D5061F966816E7277657E7708CDD870.png" width="491" height="16" style="vertical-align:-4px;"></img></a></p></li><li><p><span class="code">DifferenceOfPeakWavelengths.Err [nm]</span><br />
The error of the previous column, assuming that the NIST wavelength has a neglectable error. Thus, this column represents the errors of the fit position of the neon peaks.
</p></li><li><p><span class="code">Neon1_PreprocessedUncalibrated_Wavelength [nm]</span><br />
X-axis values in nm of the neon spectrum. If the original x-axis of the neon spectrum was Raman shift (cm<sup>-1</sup>), then the wavelength values in this column were calculated using the approximate laser wavelength that was provided in the neon calibration dialog.
</p></li><li><p><span class="code">Neon1_PreprocessedCalibrated_Wavelength [nm]</span><br />
X-axis values in nm of the neon spectrum after the neon calibration. Thus, the values in this column represent absolute, calibrated wavelength values.
</p></li><li><p><span class="code">Neon1_Preprocessed_Signal</span><br />
Y-values of the neon spectrum after execution of the preprocessing steps. These values can be plotted either using the uncalibrated wavelength x-axis, or the calibrated one (see the previous two columns).
</p></li><li><p><span class="code">NeonCalibration_MeasuredWL [nm]</span><br />
X-axis values in nm of the neon spectrum. If the original x-axis of the neon spectrum was Raman shift (cm<sup>-1</sup>), then the wavelength values in this column were calculated using the approximate laser wavelength that was provided in the neon calibration dialog.
</p></li><li><p><span class="code">NeonCalibration_DifferenceWL [nm]</span><br />
Contains the difference wavelength values in nm. By adding these difference values to the uncalibrated x-axis values (see previous column), the calibrated x-axis in absolute nm is obtained.
</p></li><li><p><span class="code">SiliconPeakShift [cm-1]</span><br />
This column only contains a single value, which is the peak position of the silicon peak (obtained from the fit of this peak).
</p></li><li><p><span class="code">SiliconPeakShift.Err [cm-1]</span><br />
This column only contains a single value, which is the peak position error of the silicon peak (obtained from the fit of this peak).
</p></li><li><p><span class="code">XCalibration_UncalibratedX</span><br />
Contains the uncalibrated x-axis in the unit in which the neon and silicon spectrum were provided.
</p></li><li><p><span class="code">XCalibration_CalibratedX</span><br />
Contains the calibrated x-axis in the unit in which the neon and silicon spectrum were provided. The calibration uses here both the neon and silicon calibration.
</p></li><li><p><span class="code">XCalibration_XDeviation</span><br />
Contains the difference between calibrated and uncalibrated x-axis values.
</p></li></ul><blockquote><p><strong>Note</strong><br />
Most of the columns in this table are for your information only.
To apply an x-axis calibration to another spectrum, only the columns <span class="code">XCalibration_UncalibratedX</span> and <span class="code">XCalibration_CalibratedX</span> are necessary.
</p></blockquote><h4 id="Section_RamanSpectroscopy_IntensityCalibration">Intensity calibration of a Raman device with a known light source</h4><h4 id="04AE4E635A50D72F6F6B3AA071D3B1D8">Objective</h4><p>
The spectrometer of a Raman device has a sensitivity which is dependent on the wavelength. The sensitivity varies from device to device, even if they are coming from the same manufacturer.
</p><p>
The <strong>objective</strong> of the intensity calibration is to find a wavelength dependent correction function, which corrects the different sensitivities of the spectrometers. Although no absolute calibration is possible, this will make Raman spectra from different devices better comparable, because the relative heights of the peaks will be the same.
</p><h4 id="BC6B39C0B2DBB3916337D9BFF09F2A96">What is needed</h4><p>
For intensity calibration, a light source with a known spectrum is necessary:
</p><ul><li><p>
Either, a  fluorescent glass is exited with the Raman laser, which will then emit light with a broad spectral distribution. Usually, for each laser wavelength, another glass is used. Such standards are available for instance from NIST, and they are accompanied by a description of the wavelength dependent intensity.
</p></li><li><p>
Or, a known light source, for instance an LED with a known (preferable broad) spectrum, is used. The spectrum of the LED must cover the range of the spectrometer. Those light sources come with a certificate, in which the wavelength dependent intensity is described as a function.
</p></li></ul><h4 id="80D4677DDB39CCB3E59C85E5D84F7DBF">What is measured</h4><p>
When using the fluorescent glass, follow the instructions accompanying this standard. The laser must be switched on for the measurement. Acquire a spectrum which is neither overexposed nor underexposed. Multiple accumulations can enhance the signal to noise ratio.
</p><p>
When using the known light source, the laser must not be switched on. Take a spectrum of the light source which is neither overexposed nor underexposed. Multiple accumulations can enhance the signal to noise ratio.
</p><blockquote><p><strong>Important</strong>:<br />
For both methods it is absolutely necessary to acquire a dark spectrum (a spectrum with laser and all other light sources off). On some instruments, a dark spectrum is acquired automatically, and is then part of the exported spectrum. Ideally, the exported spectrum contains already one column, in which the dark spectrum is subtracted from the signal spectrum.
</p></blockquote><h4 id="380374604E5FFD9E9CE0D46DAFDBE1F7">Data evaluation</h4><p>
Load the acquired spectrum into an empty worksheet. For that, create an empty worksheet, and then use <span class="code">File → Import → Ascii</span>, or <span class="code">File → Import → SPC </span>or some of the other file import menu points, according to the file format of the spectra. Details on how to import can be find <a href="C05A56A60B14F185E807BF8B9E97276F.htm#Section_ImportOfSpectra">here</a>.
</p><p>
Make sure that the x-axis of the spectrum is marked as type "X". Take a look at the spectrum by plotting it. It should have a broad distribution, i.e. the intensity should be high enough in all parts of the spectrum (except in the range close to the laser wavelength, where filter catch the light).
</p><p>
If the dark spectrum was exported to a separate file, then import that spectrum, too.
</p><p><strong>Intensity calibration</strong></p><p>
Go to the worksheet which contains the spectrum. If the worksheet contains a column in which the dark spectrum is already subtracted, then select this column. Otherwise, select the column with the y-values of the spectrum, and use the menu <span class="code">Analysis → Spectroscopy → Intensity calibration</span>. A dialog opens.
</p><p>
Its upper part contain the spectral preprocessing pipeline. If the dark signal is already subtracted, no preprocessing should be used here. If it is not already subtracted, then use the tab 'Dark', choose <span class="code">SpectrumSubtraction</span>, and provide the table which contains the dark spectrum and the x and y-column names of that spectrum.
</p><p>
In the lower part of the dialog, a function must be entered, which describes the intensity in dependence of the wavelength. Usually, a Gaussian distribution (with one term, with no baseline or a constant baseline is used). Make sure that the function you select is identical to the function that come with the certificate of the light source. The selected function is described in the right part of the dialog. Enter the parameters given on the certificate. Make also sure that the x-axis of your spectrum matches the x-axis unit given in the certificate. Example: if your x-axis is Raman shift, but on the certificate the x-axis unit is wavelength, then you can not perform intensity calibration.
</p><p>
Press OK to perform the intensity calibration. A new table is created, which contains the correction function.
</p><h4 id="6439392E833B0642F55500E4ECEB153D">Perform an intensity correction</h4><p>
In subsequent <a href="C05A56A60B14F185E807BF8B9E97276F.htm#Section_SpectralPreprocessing">preprocessing operations</a>, this calibration table can be used for intensity correction. Use the tab <span class="code">YCal</span> of the preprocessing pipeline, select <span class="code">YCalibrationByDataSource</span>, and in the combobox, choose the table containing the intensity calibration.
</p></div><hr /><div id="IDGABSection" class="collapsibleSection"><p>
Next section: <a href="D7216AC7DC127824F9628052A8B61BF1.htm">Appendix</a></p></div></div></div><div id="PageFooter" class="pageFooter">Altaxo can be downloaded from <a href="https://sourceforge.net/projects/altaxo/files/Altaxo/">SourceForge</a>. Source code available on <a href="https://github.com/Altaxo/Altaxo">Github</a>.
<br /><a href="https://sourceforge.net/u/dlellinger/profile/">(C) Dr. Dirk Lellinger and all contributors to the source code 2002 - <script>document.write(new Date().getFullYear()); </script></a><div class="feedbackLink">Send comments on this topic to
        <a id="HT_MailLink" href="mailto:dlellinger%40users.sourceforge.net?Subject=Altaxo%20user%20manual%20and%20class%20reference">dlellinger@users.sourceforge.net</a></div>
        <script type="text/javascript">
        var HT_mailLink = document.getElementById("HT_MailLink");
        HT_mailLink.href += ": " + document.title + "\u0026body=" + encodeURIComponent("Your feedback is used to improve the documentation and the product. Your e-mail address will not be used for any other purpose and is disposed of after the issue you report is resolved. While working to resolve the issue that you report, you may be contacted via e-mail to get further details or clarification on the feedback you sent. After the issue you report has been addressed, you may receive an e-mail to let you know that your feedback has been addressed.");
        </script></div></body></html>